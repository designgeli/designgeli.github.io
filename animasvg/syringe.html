<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>注射器工作原理動畫</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
        #root {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const PlayIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
        );

        const PauseIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
        );

        const RotateCcwIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="1 4 1 10 7 10"></polyline>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
            </svg>
        );

        const SyringeAnimation = () => {
          const [step, setStep] = useState(0);
          const [isPlaying, setIsPlaying] = useState(false);
          const [plungerPos, setPlungerPos] = useState(230);

          const steps = [
            { title: '初始狀態', desc: '注射器處於空置狀態，活塞在最前端' },
            { title: '抽取液體', desc: '向後拉動活塞，創造負壓，液體被吸入針筒' },
            { title: '充滿液體', desc: '針筒內充滿液體，準備注射' },
            { title: '注射過程', desc: '推動活塞，液體通過針頭注入' },
            { title: '完成注射', desc: '液體完全注入，注射完成' }
          ];

          useEffect(() => {
            if (isPlaying) {
              const timer = setTimeout(() => {
                if (step < 4) {
                  setStep(step + 1);
                } else {
                  setIsPlaying(false);
                }
              }, 2000);
              return () => clearTimeout(timer);
            }
          }, [step, isPlaying]);

          useEffect(() => {
            switch(step) {
              case 0: setPlungerPos(230); break;  // 活塞在最前端（針筒外）
              case 1: setPlungerPos(370); break;  // 活塞向後拉
              case 2: setPlungerPos(370); break;  // 保持充滿狀態
              case 3: setPlungerPos(300); break;  // 活塞向前推
              case 4: setPlungerPos(230); break;  // 活塞回到最前端
              default: setPlungerPos(230);
            }
          }, [step]);

          const getLiquidWidth = () => {
            const barrelStart = 20;  // 針筒左側內壁位置
            const barrelEnd = 205;  // 針筒右側內壁位置
            const plungerFront = plungerPos - 205;  // 活塞前端在針筒內的位置
            
            // 液體寬度 = 活塞位置 - 針筒起始位置
            const liquidWidth = Math.min(plungerFront - barrelStart, barrelEnd - barrelStart);
            return Math.max(0, liquidWidth);
          };

          const handlePlayPause = () => {
            if (step === 4 && !isPlaying) {
              setStep(0);
            }
            setIsPlaying(!isPlaying);
          };

          const handleReset = () => {
            setStep(0);
            setIsPlaying(false);
          };

          return (
            <div style={{
              width: '100%',
              height: '100%',
              background: 'linear-gradient(to bottom right, #eff6ff, #ecfeff)',
              padding: '2rem',
              display: 'flex',
              flexDirection: 'column',
              alignItems: 'center',
              justifyContent: 'center',
              boxSizing: 'border-box',
              overflow: 'auto'
            }}>
              <div style={{
                background: 'white',
                borderRadius: '1rem',
                boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.25)',
                padding: '2rem',
                maxWidth: '64rem',
                width: '100%'
              }}>
                <h1 style={{
                  fontSize: '1.875rem',
                  fontWeight: 'bold',
                  color: '#1f2937',
                  marginBottom: '0.5rem',
                  textAlign: 'center'
                }}>
                  注射器工作原理
                </h1>
                <p style={{
                  color: '#4b5563',
                  textAlign: 'center',
                  marginBottom: '2rem'
                }}>Hypodermic Syringe Mechanism</p>

                <div style={{
                  position: 'relative',
                  background: '#f9fafb',
                  borderRadius: '0.75rem',
                  padding: '2rem',
                  marginBottom: '1.5rem',
                  minHeight: '24rem',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center'
                }}>
                  <svg width="700" height="300" viewBox="-150 0 750 300" style={{ maxWidth: '100%', height: 'auto' }}>
                    {/* 重新繪製注射針頭和針管 */}
                    {/* Needle tip 針尖 */}
                    <polygon points="-100,145 -120,150 -100,155" fill="#777" stroke="#555" strokeWidth="2" />
                    
                    {/* Needle shaft 針管 */}
                    <rect x="-100" y="145" width="90" height="10" fill="#888" stroke="#666" strokeWidth="2" />
                    
                    {/* Needle hub 針座 */}
                    <rect x="-10" y="138" width="20" height="24" fill="#aaa" stroke="#666" strokeWidth="2" rx="2" />
                    
                    {/* Barrel 針筒外殼 - 透明玻璃效果 */}
                    <rect x="10" y="120" width="200" height="60" fill="none" stroke="#3b82f6" strokeWidth="3" rx="5" />
                    
                    {/* Inner barrel background 針筒內部背景 */}
                    <rect x="15" y="125" width="190" height="50" fill="#f0f9ff" rx="3" />
                    
                    {/* Measurement marks 刻度 - 水平方向，加強顯示 */}
                    {[0, 1, 2, 3, 4, 5].map((mark) => (
                      <g key={mark}>
                        <line 
                          x1={20 + mark * 30} 
                          y1="125" 
                          x2={20 + mark * 30} 
                          y2="138" 
                          stroke="#1e40af" 
                          strokeWidth="2.5"
                        />
                        <text 
                          x={20 + mark * 30} 
                          y="115" 
                          fill="#1e40af" 
                          fontSize="14"
                          fontWeight="bold"
                          textAnchor="middle"
                        >
                          {mark}
                        </text>
                      </g>
                    ))}
                    
                    {/* mL label */}
                    <text x="180" y="115" fill="#1e40af" fontSize="12" fontWeight="600">mL</text>
                    
                    {/* Liquid 液體 - 在針筒內部，水平方向 */}
                    {getLiquidWidth() > 0 && (
                      <rect 
                        x="20" 
                        y="130" 
                        width={getLiquidWidth()} 
                        height="40" 
                        fill="#3b82f6" 
                        opacity="0.6"
                        rx="2"
                        style={{ transition: 'all 1.5s ease-in-out' }}
                      />
                    )}

                    {/* Plunger 活塞 - 在針筒右端 */}
                    <rect 
                      x={plungerPos - 210} 
                      y="125" 
                      width="15" 
                      height="50" 
                      fill="#ef4444" 
                      stroke="#991b1b" 
                      strokeWidth="2"
                      rx="2"
                      style={{ transition: 'all 1.5s ease-in-out' }}
                    />
                    
                    {/* Plunger rod 活塞桿 - 延長到圓頭 */}
                    <rect 
                      x={plungerPos - 195} 
                      y="145" 
                      width="215" 
                      height="10" 
                      fill="#dc2626" 
                      stroke="#991b1b" 
                      strokeWidth="2"
                      style={{ transition: 'all 1.5s ease-in-out' }}
                    />
                    
                    {/* Thumb rest 拇指墊 - 固定在活塞桿右端 */}
                    <circle 
                      cx={plungerPos + 30} 
                      cy="150" 
                      r="20" 
                      fill="#f87171" 
                      stroke="#991b1b" 
                      strokeWidth="2"
                      style={{ transition: 'all 1.5s ease-in-out' }}
                    />

                    {/* Finger grips 指托 */}
                    <rect x="210" y="110" width="8" height="30" fill="#3b82f6" stroke="#1e40af" strokeWidth="1" rx="2" />
                    <rect x="210" y="160" width="8" height="30" fill="#3b82f6" stroke="#1e40af" strokeWidth="1" rx="2" />

                    {/* Labels 標籤 */}
                    <text x="-80" y="190" fill="#666" fontSize="14" fontWeight="600">注射針</text>
                    <text x="70" y="95" fill="#666" fontSize="14" fontWeight="600">針筒（含刻度）</text>
                    <text x={plungerPos + 10} y="200" fill="#666" fontSize="14" fontWeight="600" style={{ transition: 'all 1.5s ease-in-out' }}>活塞</text>
                    <text x="215" y="105" fill="#666" fontSize="12" fontWeight="600">指托</text>

                    {/* Pressure arrows 壓力箭頭 */}
                    {step === 1 && (
                      <>
                        <defs>
                          <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444" />
                          </marker>
                        </defs>
                        <line x1={plungerPos + 35} y1="230" x2={plungerPos + 85} y2="230" stroke="#ef4444" strokeWidth="3" markerEnd="url(#arrowhead)" style={{ transition: 'all 1.5s ease-in-out' }} />
                        <text x={plungerPos + 40} y="220" fill="#ef4444" fontSize="16" fontWeight="bold" style={{ transition: 'all 1.5s ease-in-out' }}>向後拉</text>
                      </>
                    )}
                    
                    {(step === 3 || step === 4) && (
                      <>
                        <defs>
                          <marker id="arrowhead2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e" />
                          </marker>
                        </defs>
                        <line x1={plungerPos + 85} y1="230" x2={plungerPos + 35} y2="230" stroke="#22c55e" strokeWidth="3" markerEnd="url(#arrowhead2)" style={{ transition: 'all 1.5s ease-in-out' }} />
                        <text x={plungerPos + 40} y="220" fill="#22c55e" fontSize="16" fontWeight="bold" style={{ transition: 'all 1.5s ease-in-out' }}>向前推</text>
                      </>
                    )}

                    {/* Liquid container (for step 1) 液體容器 */}
                    {step === 1 && (
                      <g>
                        <rect x="-80" y="180" width="40" height="60" fill="#e0f2fe" stroke="#3b82f6" strokeWidth="2" rx="3" />
                        <rect x="-78" y="200" width="36" height="38" fill="#3b82f6" opacity="0.6" />
                        <text x="-60" y="255" fill="#666" fontSize="11" fontWeight="600" textAnchor="middle">藥瓶</text>
                      </g>
                    )}
                  </svg>
                </div>

                <div style={{
                  background: '#eff6ff',
                  borderRadius: '0.5rem',
                  padding: '1.5rem',
                  marginBottom: '1.5rem'
                }}>
                  <div style={{
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'space-between',
                    marginBottom: '0.75rem',
                    flexWrap: 'wrap',
                    gap: '0.5rem'
                  }}>
                    <h3 style={{
                      fontSize: '1.25rem',
                      fontWeight: 'bold',
                      color: '#1e3a8a',
                      margin: 0
                    }}>
                      步驟 {step + 1}: {steps[step].title}
                    </h3>
                    <span style={{
                      fontSize: '0.875rem',
                      color: '#2563eb',
                      fontWeight: '600'
                    }}>
                      {step + 1} / {steps.length}
                    </span>
                  </div>
                  <p style={{
                    color: '#374151',
                    fontSize: '1.125rem',
                    margin: 0
                  }}>{steps[step].desc}</p>
                </div>

                <div style={{
                  display: 'flex',
                  justifyContent: 'center',
                  gap: '1rem',
                  flexWrap: 'wrap'
                }}>
                  <button
                    onClick={handlePlayPause}
                    style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '0.5rem',
                      background: '#2563eb',
                      color: 'white',
                      padding: '0.75rem 1.5rem',
                      borderRadius: '0.5rem',
                      fontWeight: '600',
                      border: 'none',
                      cursor: 'pointer',
                      boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)',
                      fontSize: '1rem',
                      transition: 'background 0.2s'
                    }}
                    onMouseOver={(e) => e.currentTarget.style.background = '#1d4ed8'}
                    onMouseOut={(e) => e.currentTarget.style.background = '#2563eb'}
                  >
                    {isPlaying ? <PauseIcon /> : <PlayIcon />}
                    <span>{isPlaying ? '暫停' : step === 4 ? '重新播放' : '播放'}</span>
                  </button>
                  <button
                    onClick={handleReset}
                    style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '0.5rem',
                      background: '#4b5563',
                      color: 'white',
                      padding: '0.75rem 1.5rem',
                      borderRadius: '0.5rem',
                      fontWeight: '600',
                      border: 'none',
                      cursor: 'pointer',
                      boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)',
                      fontSize: '1rem',
                      transition: 'background 0.2s'
                    }}
                    onMouseOver={(e) => e.currentTarget.style.background = '#374151'}
                    onMouseOut={(e) => e.currentTarget.style.background = '#4b5563'}
                  >
                    <RotateCcwIcon />
                    <span>重置</span>
                  </button>
                </div>

                <div style={{
                  marginTop: '2rem',
                  background: 'linear-gradient(to right, #ecfeff, #eff6ff)',
                  borderRadius: '0.5rem',
                  padding: '1.5rem'
                }}>
                  <h4 style={{
                    fontWeight: 'bold',
                    color: '#1f2937',
                    marginBottom: '0.75rem',
                    fontSize: '1.125rem',
                    marginTop: 0
                  }}>工作原理說明：</h4>
                  <ul style={{
                    color: '#374151',
                    lineHeight: '1.75',
                    paddingLeft: '1.5rem',
                    margin: 0
                  }}>
                    <li style={{ marginBottom: '0.5rem' }}><strong>負壓原理：</strong>向後拉動活塞時，針筒內產生負壓，大氣壓力將液體從藥瓶推入針筒</li>
                    <li style={{ marginBottom: '0.5rem' }}><strong>正壓原理：</strong>向前推動活塞時，針筒內產生正壓，將液體從針頭擠出</li>
                    <li style={{ marginBottom: '0.5rem' }}><strong>密閉系統：</strong>活塞與針筒壁形成密封，確保壓力差能有效作用</li>
                    <li><strong>液體流動：</strong>液體在針筒內水平移動，從左側針頭進出，活塞控制液體的位置和流量</li>
                  </ul>
                </div>
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SyringeAnimation />);
    </script>
</body>
</html>